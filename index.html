<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Great Mind Profile</title>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-2HR8S7SQES"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-2HR8S7SQES');
    </script>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- html2canvas for image generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Google Fonts: Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            overflow-x: hidden;
        }
        .font-headline {
            font-family: 'Poppins', sans-serif;
            font-weight: 800;
        }
        .title-shadow {
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.1);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.8s ease-out forwards;
        }
        .fade-out {
            animation: fadeOut 0.5s ease-out forwards;
        }
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        .score-bar-gradient {
            background-image: linear-gradient(to right, #3b82f6, #22c55e);
        }
        /* Styling for multi-choice options in situational questions */
        .choice-btn {
            display: block;
            width: 100%;
            text-align: left;
            padding: 1rem;
            margin-bottom: 0.75rem;
            border-radius: 0.75rem;
            font-weight: 600;
            transition: background-color 0.2s, transform 0.2s;
        }
        .choice-btn:hover {
            transform: translateY(-2px);
        }
        /* Animated Mind Map Background */
        .mind-map-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }
        .mind-map-bg svg {
            position: absolute;
            width: 150%;
            height: 150%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0.1;
            animation: rotate-bg 120s linear infinite;
        }
        .mind-map-bg circle {
            animation: pulse-node 8s ease-in-out infinite alternate;
        }
        .mind-map-bg circle:nth-child(2n) { animation-delay: -2s; }
        .mind-map-bg circle:nth-child(3n) { animation-delay: -4s; }
        .mind-map-bg circle:nth-child(4n) { animation-delay: -6s; }

        @keyframes rotate-bg {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }
        @keyframes pulse-node {
            from { r: 3; }
            to { r: 6; }
        }
        
        /* Sliding cards animation */
        .scrolling-wrapper {
            display: flex;
            flex-wrap: nowrap;
            animation: scroll-horizontal 40s linear infinite;
        }
        @keyframes scroll-horizontal {
            from { transform: translateX(0%); }
            to { transform: translateX(-100%); }
        }
        .card-container {
            flex-shrink: 0;
            width: 100%;
            max-width: 90%; /* Adjust card width on mobile */
        }
        @media (min-width: 768px) {
            .card-container {
                max-width: 33.33%;
            }
        }
        
        /* Thematic loading bar */
        #loading-bar-inner {
             transition: width 0.1s linear;
             background-image: linear-gradient(to right, #4f46e5, #d946ef, #f59e0b);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-200 text-gray-800 relative">

    <!-- Homepage Container (Visible by default) -->
    <div id="homepage-container" class="flex flex-col items-center justify-center min-h-screen p-4 text-center relative z-10 transition-opacity duration-500">
        <div class="mind-map-bg">
            <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                <defs>
                    <linearGradient id="lineGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" style="stop-color:#a5b4fc;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#f9a8d4;stop-opacity:1" />
                    </linearGradient>
                </defs>
                <g stroke="url(#lineGradient)" stroke-width="0.5">
                    <line x1="100" y1="100" x2="50" y2="50" /> <line x1="100" y1="100" x2="150" y2="50" /> <line x1="100" y1="100" x2="50" y2="150" /> <line x1="100" y1="100" x2="150" y2="150" /> <line x1="50" y1="50" x2="20" y2="80" /> <line x1="50" y1="50" x2="80" y2="20" /> <line x1="150" y1="50" x2="120" y2="20" /> <line x1="150" y1="50" x2="180" y2="80" /> <line x1="50" y1="150" x2="20" y2="120" /> <line x1="50" y1="150" x2="80" y2="180" /> <line x1="150" y1="150" x2="120" y2="180" /> <line x1="150" y1="150" x2="180" y2="120" />
                </g>
                <circle cx="100" cy="100" r="5" fill="#6366f1"/> <circle cx="50" cy="50" r="4" fill="#818cf8"/> <circle cx="150" cy="50" r="4" fill="#818cf8"/> <circle cx="50" cy="150" r="4" fill="#818cf8"/> <circle cx="150" cy="150" r="4" fill="#818cf8"/> <circle cx="20" cy="80" r="3" fill="#a5b4fc"/> <circle cx="80" cy="20" r="3" fill="#a5b4fc"/> <circle cx="120" cy="20" r="3" fill="#a5b4fc"/> <circle cx="180" cy="80" r="3" fill="#a5b4fc"/> <circle cx="20" cy="120" r="3" fill="#a5b4fc"/> <circle cx="80" cy="180" r="3" fill="#a5b4fc"/> <circle cx="120" cy="180" r="3" fill="#a5b4fc"/> <circle cx="180" cy="120" r="3" fill="#a5b4fc"/>
            </svg>
        </div>
        
        <button id="lang-icon-btn" class="absolute top-4 right-4 text-gray-600 hover:text-black p-2 rounded-full hover:bg-gray-200 transition">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21.3,12a9.3,9.3,0,1,1-9.3-9.3A9.3,9.3,0,0,1,21.3,12Z" />
              <line x1="3.6" y1="9" x2="20.4" y2="9" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/>
              <line x1="3.6" y1="15" x2="20.4" y2="15" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"/>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12,2.7a15.7,15.7,0,0,1,0,18.6" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12,2.7a15.7,15.7,0,0,0,0,18.6" />
            </svg>
        </button>

        <div id="lang-popup" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
            <div class="bg-white rounded-2xl p-6 shadow-xl text-center max-w-sm">
                <h3 class="text-xl font-bold mb-4">Languages</h3>
                <p class="text-gray-600 mb-6">More languages coming soon!</p>
                <button id="close-popup-btn" class="bg-blue-600 text-white font-bold px-6 py-2 rounded-full">OK</button>
            </div>
        </div>

        <div class="flex-grow flex flex-col items-center justify-center w-full max-w-4xl pt-20">
            <header class="relative mb-4">
                <h1 id="home-title" class="font-headline text-5xl sm:text-6xl md:text-7xl leading-tight tracking-tighter title-shadow">
                    <span class="bg-gradient-to-r from-blue-500 via-red-500 to-yellow-500 bg-clip-text text-transparent">
                        Great Mind Profile
                    </span>
                </h1>
                <h2 class="text-lg md:text-2xl text-gray-600 font-semibold mt-2">A Multi-Level Personality Assessment</h2>
            </header>

            <main class="max-w-2xl mx-auto mt-8">
                <p id="home-description" class="text-lg md:text-xl text-gray-700 mb-12">
                    Discover your unique strengths. Our analysis is based on the scientifically validated <strong>HEXACO model</strong> for a surprisingly accurate personality profile.
                </p>
                <button id="start-test-btn" class="inline-block bg-gray-800 text-white font-bold text-xl px-10 py-4 rounded-full shadow-lg transform transition-transform duration-300 hover:scale-105 hover:bg-black focus:outline-none focus:ring-4 focus:ring-gray-400">
                    Start the Test!
                </button>
            </main>
        </div>

        <section class="w-full max-w-6xl overflow-hidden py-12">
            <h2 class="text-3xl font-bold text-center mb-12">Why Choose Us?</h2>
            <div class="scrolling-wrapper">
                <!-- Cards are duplicated for a seamless loop -->
                <div class="card-container p-4"><div class="bg-blue-100 p-6 rounded-xl shadow-md h-full"><h3 class="text-xl font-bold mb-2 text-blue-800">Based on Science</h3><p class="text-gray-600">Our test is built on the HEXACO model, a robust framework trusted by psychologists for its accuracy and cross-cultural validity.</p></div></div>
                <div class="card-container p-4"><div class="bg-green-100 p-6 rounded-xl shadow-md h-full"><h3 class="text-xl font-bold mb-2 text-green-800">Three-Level Analysis</h3><p class="text-gray-600">We go beyond simple traits by analyzing your situational judgments and life story themes to create a truly holistic profile.</p></div></div>
                <div class="card-container p-4"><div class="bg-indigo-100 p-6 rounded-xl shadow-md h-full"><h3 class="text-xl font-bold mb-2 text-indigo-800">Actionable Insights</h3><p class="text-gray-600">Understand your strengths and potential challenges with clear, non-judgmental feedback designed for personal growth.</p></div></div>
                <div class="card-container p-4"><div class="bg-blue-100 p-6 rounded-xl shadow-md h-full"><h3 class="text-xl font-bold mb-2 text-blue-800">Based on Science</h3><p class="text-gray-600">Our test is built on the HEXACO model, a robust framework trusted by psychologists for its accuracy and cross-cultural validity.</p></div></div>
                <div class="card-container p-4"><div class="bg-green-100 p-6 rounded-xl shadow-md h-full"><h3 class="text-xl font-bold mb-2 text-green-800">Three-Level Analysis</h3><p class="text-gray-600">We go beyond simple traits by analyzing your situational judgments and life story themes to create a truly holistic profile.</p></div></div>
                <div class="card-container p-4"><div class="bg-indigo-100 p-6 rounded-xl shadow-md h-full"><h3 class="text-xl font-bold mb-2 text-indigo-800">Actionable Insights</h3><p class="text-gray-600">Understand your strengths and potential challenges with clear, non-judgmental feedback designed for personal growth.</p></div></div>
            </div>
        </section>

        <footer class="w-full text-center py-4">
            <p id="footer-text" class="text-gray-500 text-sm">&copy; 2024 Personality Post. All Rights Reserved.</p>
        </footer>
    </div>

    <!-- Test Container (Initially Hidden) -->
    <div id="test-container" class="hidden min-h-screen flex-col items-center justify-center p-4 transition-opacity duration-500">
        <div class="w-full max-w-2xl mb-8">
            <div class="flex justify-between mb-1">
                <span id="progress-title" class="text-base font-medium text-gray-700"></span>
                <span id="progress-text" class="text-sm font-medium text-gray-700"></span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-2.5">
                <div id="progress-bar" class="bg-blue-500 h-2.5 rounded-full" style="width: 0%"></div>
            </div>
        </div>
        <div class="bg-white p-8 rounded-2xl shadow-md w-full max-w-2xl">
            <h2 id="question-text" class="text-2xl md:text-3xl font-bold text-gray-800 text-center mb-8"></h2>
            <div id="answer-options"></div>
            <div class="mt-8 text-center">
                <button id="back-btn" class="text-gray-500 hover:text-gray-800 font-semibold py-2 px-4">&larr; Back</button>
            </div>
        </div>
    </div>
    
    <!-- Loading Container (Initially Hidden) -->
    <div id="loading-container" class="hidden min-h-screen flex-col items-center justify-center p-4">
        <div class="w-full max-w-md text-center">
            <h2 class="text-3xl font-bold text-gray-700 mb-4">Analyzing Your Profile...</h2>
            <div class="w-full bg-gray-200 rounded-full h-4">
                <div id="loading-bar-inner" class="h-4 rounded-full" style="width: 0%"></div>
            </div>
        </div>
    </div>


    <!-- Results Container (Initially Hidden) -->
    <div id="results-container" class="hidden bg-gray-100 p-4 sm:p-6 md:p-8">
        <div id="results-content" class="max-w-4xl mx-auto pb-16">
            <div class="bg-white p-8 rounded-2xl shadow-md w-full mb-8 fade-in">
                <h2 id="results-main-title" class="text-3xl md:text-4xl font-extrabold text-center mb-2">Your Integrated Profile:</h2>
                <p id="profile-title" class="text-2xl md:text-3xl font-bold text-center mb-2"></p>
                <p id="profile-subtypes" class="text-center text-gray-600 font-semibold mb-6"></p>
                <p id="profile-summary" class="text-gray-700 text-lg"></p>
                <div id="level2-summary" class="mt-4 p-4 bg-blue-50 rounded-lg"></div>
                <div id="level3-summary" class="mt-4 p-4 bg-indigo-50 rounded-lg"></div>
            </div>

            <div class="bg-white p-8 rounded-2xl shadow-md w-full mb-8 fade-in" style="animation-delay: 0.2s;">
                <h3 id="results-breakdown-title" class="text-2xl font-bold text-center mb-6">Your Trait Breakdown</h3>
                <div id="trait-details" class="grid grid-cols-1 md:grid-cols-2 gap-8"></div>
            </div>

            <div class="bg-white p-8 rounded-2xl shadow-md w-full fade-in" style="animation-delay: 0.4s;">
                <h3 id="results-next-steps-title" class="text-2xl font-bold text-center mb-6">Next Steps</h3>
                <div class="flex flex-col sm:flex-row justify-center items-center gap-4">
                     <button id="download-btn" class="w-full sm:w-auto inline-block bg-gray-800 text-white font-bold text-lg px-8 py-3 rounded-full shadow-lg transform transition-transform duration-300 hover:scale-105 hover:bg-black focus:outline-none focus:ring-4 focus:ring-gray-400">Download Results</button>
                     <button id="share-btn" class="w-full sm:w-auto inline-block bg-blue-600 text-white font-bold text-lg px-8 py-3 rounded-full shadow-lg transform transition-transform duration-300 hover:scale-105 hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300">Share with Friends</button>
                     <button id="retake-test-btn" class="w-full sm:w-auto inline-block bg-gray-500 text-white font-bold text-lg px-8 py-3 rounded-full shadow-lg transform transition-transform duration-300 hover:scale-105 hover:bg-gray-600 focus:outline-none focus:ring-4 focus:ring-gray-400">Retake Test</button>
                </div>
                 <p id="share-message" class="text-center text-gray-600 mt-4"></p>
            </div>
        </div>
    </div>

    <script>
        // --- Question Banks ---
        const level1Questions = [
            { text: "I wouldn't use flattery to get ahead.", dimension: 'H', score: 1 },
            { text: "If I want something from someone, I will laugh at their worst jokes.", dimension: 'H', score: -1 },
            { text: "I feel a strong sense of entitlement for special treatment.", dimension: 'H', score: -1 },
            { text: "I would never accept a bribe, even if it were very large.", dimension: 'H', score: 1 },
            { text: "I'm not interested in showing off my wealth or status.", dimension: 'H', score: 1 },
            { text: "I'd be tempted to use counterfeit money if I were sure I could get away with it.", dimension: 'H', score: -1 },
            { text: "Having a lot of money is not especially important to me.", dimension: 'H', score: 1 },
            { text: "I would get a lot of pleasure from owning expensive luxury goods.", dimension: 'H', score: -1 },
            { text: "I think that I am an ordinary person who is no better than others.", dimension: 'H', score: 1 },
            { text: "I sometimes feel that I am a worthless person.", dimension: 'E', score: 1 },
            { text: "I worry a lot, even about things that are not very likely to happen.", dimension: 'E', score: 1 },
            { text: "I get very sentimental when watching emotional movies.", dimension: 'E', score: 1 },
            { text: "I remain calm in stressful situations.", dimension: 'E', score: -1 },
            { text: "I rarely feel sad or blue.", dimension: 'E', score: -1 },
            { text: "I am not a worrier.", dimension: 'E', score: -1 },
            { text: "I feel like crying when I see other people crying.", dimension: 'E', score: 1 },
            { text: "I am not easily frightened.", dimension: 'E', score: -1 },
            { text: "I tend to be a very anxious person.", dimension: 'E', score: 1 },
            { text: "I feel that I am an unpopular person.", dimension: 'X', score: -1 },
            { text: "In social situations, I'm usually the one who makes the first move.", dimension: 'X', score: 1 },
            { text: "I am the life of the party.", dimension: 'X', score: 1 },
            { text: "I prefer to be in the background.", dimension: 'X', score: -1 },
            { text: "I have a lot of energy.", dimension: 'X', score: 1 },
            { text: "I don't like to draw attention to myself.", dimension: 'X', score: -1 },
            { text: "I am a very enthusiastic person.", dimension: 'X', score: 1 },
            { text: "I enjoy being alone.", dimension: 'X', score: -1 },
            { text: "People sometimes tell me that I am too critical of others.", dimension: 'A', score: -1 },
            { text: "I tend to be lenient in my judgments of others.", dimension: 'A', score: 1 },
            { text: "I rarely hold a grudge, even against people who have harmed me.", dimension: 'A', score: 1 },
            { text: "I get angry easily.", dimension: 'A', score: -1 },
            { text: "I am a very patient person.", dimension: 'A', score: 1 },
            { text: "I am not a very forgiving person.", dimension: 'A', score: -1 },
            { text: "I am a very gentle person.", dimension: 'A', score: 1 },
            { text: "I am not a very cooperative person.", dimension: 'A', score: -1 },
            { text: "I often push myself to my limits when working on a task.", dimension: 'C', score: 1 },
            { text: "I am a very organized person.", dimension: 'C', score: 1 },
            { text: "I often make impulsive decisions.", dimension: 'C', score: -1 },
            { text: "I make sure my work is perfect, down to the last detail.", dimension: 'C', score: 1 },
            { text: "I am not a very disciplined person.", dimension: 'C', score: -1 },
            { text: "I am a very reliable person.", dimension: 'C', score: 1 },
            { text: "I am not a very careful person.", dimension: 'C', score: -1 },
            { text: "I am a very diligent person.", dimension: 'C', score: 1 },
            { text: "I would be bored by a visit to an art gallery.", dimension: 'O', score: -1 },
            { text: "I am fascinated by the beauty of nature.", dimension: 'O', score: 1 },
            { text: "I like to solve complex problems and puzzles.", dimension: 'O', score: 1 },
            { text: "I think of myself as a highly creative person.", dimension: 'O', score: 1 },
            { text: "I am not interested in abstract ideas.", dimension: 'O', score: -1 },
            { text: "I have a rich vocabulary.", dimension: 'O', score: 1 },
            { text: "I have a vivid imagination.", dimension: 'O', score: 1 },
            { text: "I am not interested in theoretical discussions.", dimension: 'O', score: -1 },
        ];
        const level2Questions = [
            { text: "You're in a group discussion and someone publicly criticizes an idea you just presented. How do you respond?", type: 'situational', options: [ { text: "Defend your idea immediately and point out the flaws in their criticism.", dimension: 'X' }, { text: "Acknowledge their point and suggest discussing it further after the discussion.", dimension: 'A' }, { text: "Say nothing but feel discouraged for the rest of the discussion.", dimension: 'E' }, { text: "Ask them to elaborate on their concerns so you can understand their perspective.", dimension: 'O' } ] },
            { text: "You have an important personal deadline approaching, but a close friend asks for your help with an urgent problem. What do you do?", type: 'situational', options: [ { text: "Politely explain your deadline and offer to help them as soon as it's done.", dimension: 'C' }, { text: "Drop what you're doing immediately to help your friend; relationships are more important.", dimension: 'A' }, { text: "Feel anxious and torn, trying to juggle both at once and not doing either well.", dimension: 'E' }, { text: "Suggest an unconventional, quick solution for their problem so you can get back to your task.", dimension: 'O' } ] },
            { text: "You find a way to get something done much faster, but it involves bending a rule you've agreed to follow. What's your move?", type: 'situational', options: [ { text: "Use the faster method. The result is what matters most.", dimension: 'H', score: -1 }, { text: "Stick to the rules. An agreement is an agreement.", dimension: 'H', score: 1 }, { text: "Propose a formal change to the rule, explaining the benefits of the new method.", dimension: 'C' }, { text: "Ask someone else for their opinion before doing anything.", dimension: 'E' } ] },
            { text: "You're invited to a large, noisy party where you only know one person. What's your game plan?", type: 'situational', options: [ { text: "Jump right in and start introducing yourself to new people.", dimension: 'X' }, { text: "Find a quiet corner and observe people for a while before engaging.", dimension: 'X', score: -1 }, { text: "Stick close to the person you know all night.", dimension: 'E' }, { text: "Find the most interesting-looking person and start a deep conversation.", dimension: 'O' } ] },
            { text: "Someone asks you for help with a complex task but gives you vague instructions. What is your first step?", type: 'situational', options: [ { text: "Create a detailed plan with your best assumptions and present it for their feedback.", dimension: 'C' }, { text: "Start experimenting with different approaches to see what works best.", dimension: 'O' }, { text: "Ask for clarification and specific examples before you begin.", dimension: 'E' }, { text: "Collaborate with them to brainstorm ideas and figure it out together.", dimension: 'A' } ] },
            { text: "Someone in a group project isn't doing their share of the work, and it's affecting the outcome. How do you handle it?", type: 'situational', options: [ { text: "Confront them directly and honestly about the issue.", dimension: 'H', score: 1 }, { text: "Pick up their slack to avoid conflict and keep the project moving.", dimension: 'A' }, { text: "Bring up the issue with the group to find a collective solution.", dimension: 'C' }, { text: "Try to understand if they're struggling and offer your help.", dimension: 'E' } ] },
            { text: "You have a free weekend with no plans. How do you spend it?", type: 'situational', options: [ { text: "Call up friends and organize a group activity.", dimension: 'X' }, { text: "Tackle a personal project or organize your home.", dimension: 'C' }, { text: "Visit a museum, read a book on a new topic, or explore a new place.", dimension: 'O' }, { text: "Relax at home and recharge your batteries in peace and quiet.", dimension: 'X', score: -1 } ] },
            { text: "You made a significant mistake that affects others, but no one has noticed yet. What do you do?", type: 'situational', options: [ { text: "Own up to it immediately and propose a solution.", dimension: 'H', score: 1 }, { text: "Wait to see if anyone notices before saying anything.", dimension: 'H', score: -1 }, { text: "Try to fix it quietly without telling anyone.", dimension: 'C' }, { text: "Worry endlessly about being discovered.", dimension: 'E' } ] },
            { text: "When faced with a difficult personal decision, you are most likely to:", type: 'situational', options: [ { text: "Trust your gut feelings and intuition.", dimension: 'O' }, { text: "Create a pro-con list and analyze it logically.", dimension: 'C' }, { text: "Talk it through with several friends to get their opinions.", dimension: 'X' }, { text: "Choose the option that will cause the least conflict with others.", dimension: 'A' } ] },
            { text: "Someone cuts in front of you in a long line. Your immediate reaction is to:", type: 'situational', options: [ { text: "Politely point out that there is a line and you were next.", dimension: 'H', score: 1 }, { text: "Say nothing, but be visibly annoyed and complain to the person behind you.", dimension: 'A', score: -1 }, { text: "Let it go. It's not worth the confrontation.", dimension: 'A' }, { text: "Loudly call them out so everyone in line knows what they did.", dimension: 'X' } ] },
            { text: "You have a choice between a life path that is stable and secure, and another that is riskier but more exciting. You choose:", type: 'situational', options: [ { text: "The stable and secure path. Predictability is important.", dimension: 'C' }, { text: "The risky but exciting path. You thrive on new challenges.", dimension: 'O' }, { text: "The path that offers the greatest personal gain, regardless of risk.", dimension: 'H', score: -1 }, { text: "The path that your mentors and family think is best for you.", dimension: 'E' } ] },
            { text: "When learning a new skill, you prefer to:", type: 'situational', options: [ { text: "Follow a structured course with clear steps and objectives.", dimension: 'C' }, { text: "Jump in and learn through trial and error.", dimension: 'O' }, { text: "Learn with a group or a partner.", dimension: 'X' }, { text: "Find a teacher or mentor you trust and follow their guidance.", dimension: 'A' } ] },
            { text: "A friend is telling you about a problem, you are most likely to:", type: 'situational', options: [ { text: "Listen patiently and offer emotional support.", dimension: 'E' }, { text: "Immediately start brainstorming practical solutions for them.", dimension: 'C' }, { text: "Share a story of a similar experience you had.", dimension: 'X' }, { text: "Help them see the problem from a completely different perspective.", dimension: 'O' } ] },
            { text: "You've just received a significant financial gift. Your first instinct is to:", type: 'situational', options: [ { text: "Put it into a savings or investment account.", dimension: 'C' }, { text: "Splurge on a luxury item or a lavish vacation.", dimension: 'H', score: -1 }, { text: "Throw a big party for your friends and family.", dimension: 'X' }, { text: "Donate a portion to a cause you care about.", dimension: 'A' } ] }
        ];
        const level3Question = {
            text: "Which of these core themes best reflects your personal life story so far?",
            type: 'narrative',
            options: [
                { text: "<strong>Growth:</strong> A story of overcoming challenges and continuously improving yourself.", choiceId: 'growth' },
                { text: "<strong>Redemption:</strong> A story of recovering from a negative event that ultimately led to a positive outcome.", choiceId: 'redemption' },
                { text: "<strong>Agency:</strong> A story of taking control of your life and shaping your own destiny.", choiceId: 'agency' },
                { text: "<strong>Connection:</strong> A story of finding meaning through deep, supportive relationships with others.", choiceId: 'connection' }
            ]
        };

        // --- Descriptions and Profiles ---
        const profiles = {
            H: { title: "The Principled Realist", color: "text-gray-700", bgColor: "bg-slate-100", high: { facets: ["Sincerity", "Fairness", "Modesty"], summary: "You are guided by a strong sense of fairness and sincerity. You prefer to cooperate with others on equal terms, without a desire for special status or wealth. This makes you a trustworthy and genuine individual.", breakdown: "Your high score in <strong>Honesty-Humility</strong> shows you are sincere and principled. <strong>Strength:</strong> You build trust easily and are seen as a fair-minded person. <strong>Challenge:</strong> You might be uncomfortable in environments that require competitive self-promotion or aggressive tactics." }, low: { facets: ["Strategic", "Status-Driven", "Pragmatic"], summary: "You are a pragmatic and adaptable individual, comfortable with social hierarchies and using strategy to achieve your goals. You are not afraid to leverage situations to your advantage and are motivated by personal success.", breakdown: "Your low score in <strong>Honesty-Humility</strong> suggests you are strategic and self-assured. <strong>Strength:</strong> You are effective at navigating competitive situations and are not easily taken advantage of. <strong>Challenge:</strong> Others might sometimes perceive your actions as manipulative or overly self-interested." } },
            E: { title: "The Sensitive Soul", color: "text-purple-600", bgColor: "bg-purple-100", high: { facets: ["Empathy", "Fearfulness", "Sentimentality"], summary: "You are highly attuned to your emotions and the world around you. You experience feelings deeply, which allows you to form strong empathetic connections with others and be sensitive to potential dangers.", breakdown: "Your high score in <strong>Emotionality</strong> indicates you are empathetic and sensitive. <strong>Strength:</strong> Your ability to connect with others' feelings and your caution can help you avoid risky situations. <strong>Challenge:</strong> You may be prone to anxiety or worry, which can sometimes be overwhelming." }, low: { facets: ["Bravery", "Confidence", "Stability"], summary: "You are emotionally resilient and remain calm even in stressful situations. You face challenges with a steady demeanor and are not easily rattled by physical or social threats.", breakdown: "Your low score in <strong>Emotionality</strong> shows you are brave and emotionally stable. <strong>Strength:</strong> You are a rock for others during a crisis and can handle high-pressure environments. <strong>Challenge:</strong> You might sometimes find it difficult to understand or express deeper, more vulnerable emotions." } },
            X: { title: "The Social Catalyst", color: "text-orange-500", bgColor: "bg-orange-100", high: { facets: ["Sociability", "Liveliness", "Social Boldness"], summary: "You are energetic, enthusiastic, and thrive in social settings. You naturally take the lead, enjoy being the center of attention, and draw energy from being around other people.", breakdown: "Your high score in <strong>Extraversion</strong> means you are outgoing and socially confident. <strong>Strength:</strong> You are a natural leader and networker, able to inspire and energize groups. <strong>Challenge:</strong> You may feel under-stimulated or bored when spending time alone." }, low: { facets: ["Independence", "Reflection", "Reserve"], summary: "You are thoughtful and reserved, preferring quiet environments and meaningful one-on-one interactions over large social gatherings. You find your energy in reflection and solitude.", breakdown: "Your low score in <strong>Extraversion</strong> suggests you are independent and reflective. <strong>Strength:</strong> You are comfortable with your own company and can focus deeply on tasks without social distraction. <strong>Challenge:</strong> You might be overlooked in large group settings or find it draining to engage in extensive social activities." } },
            A: { title: "The Harmonizer", color: "text-green-500", bgColor: "bg-green-100", high: { facets: ["Patience", "Forgivingness", "Gentleness"], summary: "You are patient, cooperative, and easy-going. You are willing to compromise and forgive, and you generally avoid confrontation, preferring to maintain harmonious relationships with others.", breakdown: "Your high score in <strong>Agreeableness</strong> shows you are gentle and accommodating. <strong>Strength:</strong> You are an excellent team player and a supportive friend, able to smooth over conflicts. <strong>Challenge:</strong> Your reluctance to criticize might lead you to be overly tolerant of others' faults." }, low: { facets: ["Independent", "Frank", "Assertive"], summary: "You are a direct and independent thinker who is not afraid to challenge others and express a critical opinion. You hold firm to your beliefs and are willing to engage in arguments to defend your point of view.", breakdown: "Your low score in <strong>Agreeableness</strong> indicates you are independent-minded and frank. <strong>Strength:</strong> Your willingness to critique can lead to better outcomes and prevent bad decisions. <strong>Challenge:</strong> Others may sometimes see you as stubborn or argumentative." } },
            C: { title: "The Architect", color: "text-blue-600", bgColor: "bg-blue-100", high: { facets: ["Diligence", "Organization", "Perfectionism"], summary: "You are organized, disciplined, and goal-oriented. You approach tasks with a structured plan and are driven to achieve a high standard of work, making you a reliable and diligent individual.", breakdown: "Your high score in <strong>Conscientiousness</strong> means you are organized and industrious. <strong>Strength:</strong> You are highly reliable and can be counted on to get the job done right. <strong>Challenge:</strong> You might be prone to perfectionism or find it difficult to adapt when plans change unexpectedly." }, low: { facets: ["Flexibility", "Spontaneity", "Adaptability"], summary: "You are flexible and spontaneous, comfortable with a lack of structure and able to adapt to changing priorities. You are not overly concerned with rules and prefer to live in the moment.", breakdown: "Your low score in <strong>Conscientiousness</strong> suggests you are flexible and spontaneous. <strong>Strength:</strong> You are highly adaptable and can thrive in unpredictable environments. <strong>Challenge:</strong> You may struggle with disorganization or have difficulty meeting deadlines." } },
            O: { title: "The Innovator", color: "text-indigo-500", bgColor: "bg-indigo-100", high: { facets: ["Creativity", "Inquisitiveness", "Unconventionality"], summary: "You are intellectually curious, creative, and open to unconventional ideas and new experiences. You have a deep appreciation for beauty, art, and abstract thinking.", breakdown: "Your high score in <strong>Openness to Experience</strong> shows you are creative and inquisitive. <strong>Strength:</strong> You are a natural innovator, able to see possibilities that others miss. <strong>Challenge:</strong> You might sometimes be seen as impractical or find it difficult to focus on routine tasks." }, low: { facets: ["Pragmatism", "Tradition", "Concreteness"], summary: "You are practical, down-to-earth, and prefer the conventional and familiar. You find value in tradition and are most comfortable with straightforward, concrete solutions.", breakdown: "Your low score in <strong>Openness to Experience</strong> indicates you are pragmatic and conventional. <strong>Strength:</strong> You bring a grounded, common-sense approach to problems. <strong>Challenge:</strong> You may be resistant to change or overlook novel solutions." } }
        };
        
        const level3Narratives = {
            growth: "Your life story is one of <strong>Growth</strong>. This indicates you see life as a journey of learning and self-development, viewing challenges not as setbacks, but as opportunities to become a better version of yourself.",
            redemption: "Your life story follows a theme of <strong>Redemption</strong>. This suggests you have faced significant adversity but have found positive meaning and strength from it, turning a negative past into a positive future.",
            agency: "Your life story is driven by a theme of <strong>Agency</strong>. You see yourself as the author of your own destiny, actively making choices and taking actions to create the life you want to live.",
            connection: "Your life story is centered on the theme of <strong>Connection</strong>. You find your greatest sense of purpose and meaning in forming deep, supportive, and lasting bonds with friends, family, and your community."
        };

        // --- Application State & Logic ---
        let questions = [];
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let scores = { H: 0, E: 0, X: 0, A: 0, C: 0, O: 0 };
        let maxScores = { H: 0, E: 0, X: 0, A: 0, C: 0, O: 0 };
        let narrativeChoice = '';

        const homepageContainerEl = document.getElementById('homepage-container');
        const testContainerEl = document.getElementById('test-container');
        const resultsContainerEl = document.getElementById('results-container');
        const loadingContainerEl = document.getElementById('loading-container');
        const loadingBarInnerEl = document.getElementById('loading-bar-inner');
        const startTestBtn = document.getElementById('start-test-btn');
        const backBtn = document.getElementById('back-btn');
        const retakeTestBtn = document.getElementById('retake-test-btn');
        const questionTextEl = document.getElementById('question-text');
        const answerOptionsEl = document.getElementById('answer-options');
        const progressBarEl = document.getElementById('progress-bar');
        const progressTextEl = document.getElementById('progress-text');
        const progressTitleEl = document.getElementById('progress-title');
        const profileTitleEl = document.getElementById('profile-title');
        const profileSubtypesEl = document.getElementById('profile-subtypes');
        const profileSummaryEl = document.getElementById('profile-summary');
        const level2SummaryEl = document.getElementById('level2-summary');
        const level3SummaryEl = document.getElementById('level3-summary');
        const traitDetailsEl = document.getElementById('trait-details');
        const downloadBtn = document.getElementById('download-btn');
        const shareBtn = document.getElementById('share-btn');
        const shareMessageEl = document.getElementById('share-message');
        const langIconBtn = document.getElementById('lang-icon-btn');
        const langPopup = document.getElementById('lang-popup');
        const closePopupBtn = document.getElementById('close-popup-btn');

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        function startTest() {
            questions = [
                ...shuffleArray([...level1Questions]),
                ...shuffleArray([...level2Questions]),
                level3Question
            ];
            userAnswers = [];
            scores = { H: 0, E: 0, X: 0, A: 0, C: 0, O: 0 };
            maxScores = { H: 0, E: 0, X: 0, A: 0, C: 0, O: 0 };
            narrativeChoice = '';
            
            level1Questions.forEach(q => { maxScores[q.dimension] += 5; });
            currentQuestionIndex = 0;

            homepageContainerEl.classList.add('fade-out');
            setTimeout(() => {
                homepageContainerEl.style.display = 'none';
                resultsContainerEl.style.display = 'none';
                loadingContainerEl.style.display = 'none';
                testContainerEl.style.display = 'flex';
                testContainerEl.classList.remove('fade-out');
                testContainerEl.classList.add('fade-in');
                showQuestion();
            }, 500);
        }

        function showQuestion() {
            backBtn.style.visibility = currentQuestionIndex === 0 ? 'hidden' : 'visible';
            
            if (currentQuestionIndex < questions.length) {
                const question = questions[currentQuestionIndex];
                questionTextEl.textContent = question.text;
                
                if (currentQuestionIndex < level1Questions.length) {
                    progressTitleEl.textContent = 'Part 1: Core Traits';
                } else if (currentQuestionIndex < level1Questions.length + level2Questions.length) {
                    progressTitleEl.textContent = 'Part 2: Situational Judgement';
                } else {
                    progressTitleEl.textContent = 'Part 3: Life Story';
                }

                const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
                progressBarEl.style.width = `${progress}%`;
                progressTextEl.textContent = `Question ${currentQuestionIndex + 1} of ${questions.length}`;

                renderAnswerOptions(question);
            } else {
                showLoadingAndResults();
            }
        }

        function renderAnswerOptions(question) {
            answerOptionsEl.innerHTML = '';
            const choiceColors = ['bg-blue-100 text-blue-800 hover:bg-blue-200', 'bg-green-100 text-green-800 hover:bg-green-200', 'bg-yellow-100 text-yellow-800 hover:bg-yellow-200', 'bg-red-100 text-red-800 hover:bg-red-200'];

            if (question.type === 'situational' || question.type === 'narrative') {
                question.options.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.innerHTML = option.text;
                    button.className = `choice-btn ${choiceColors[index % choiceColors.length]}`;
                    button.onclick = () => handleChoiceClick(option);
                    answerOptionsEl.appendChild(button);
                });
            } else {
                const buttonHTML = `
                    <div class="grid grid-cols-1 sm:grid-cols-5 gap-3 text-center">
                        <button data-value="5" class="answer-btn bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-full transition-transform transform hover:scale-105">Strongly Agree</button>
                        <button data-value="4" class="answer-btn bg-green-300 hover:bg-green-400 text-white font-bold py-3 px-4 rounded-full transition-transform transform hover:scale-105">Agree</button>
                        <button data-value="3" class="answer-btn bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-4 rounded-full transition-transform transform hover:scale-105">Neutral</button>
                        <button data-value="2" class="answer-btn bg-red-300 hover:bg-red-400 text-white font-bold py-3 px-4 rounded-full transition-transform transform hover:scale-105">Disagree</button>
                        <button data-value="1" class="answer-btn bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-full transition-transform transform hover:scale-105">Strongly Disagree</button>
                    </div>
                `;
                answerOptionsEl.innerHTML = buttonHTML;
                answerOptionsEl.querySelectorAll('.answer-btn').forEach(btn => {
                    btn.addEventListener('click', handleAnswerClick);
                });
            }
        }

        function handleAnswerClick(e) {
            const selectedValue = parseInt(e.target.getAttribute('data-value'));
            const question = questions[currentQuestionIndex];
            const scoreValue = question.score === 1 ? selectedValue : 6 - selectedValue;
            
            userAnswers.push({ type: 'level1', dimension: question.dimension, value: scoreValue });
            scores[question.dimension] += scoreValue;
            
            currentQuestionIndex++;
            showQuestion();
        }
        
        function handleChoiceClick(option) {
            const question = questions[currentQuestionIndex];
            if (question.type === 'situational') {
                const scoreValue = option.score || 1; 
                scores[option.dimension] += scoreValue;
                userAnswers.push({ type: 'level2', dimension: option.dimension, value: scoreValue });
            } else if (question.type === 'narrative') {
                narrativeChoice = option.choiceId;
                userAnswers.push({ type: 'level3', choice: option.choiceId });
            }
            currentQuestionIndex++;
            showQuestion();
        }

        function handleBackClick() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                const lastAnswer = userAnswers.pop();
                if (lastAnswer) {
                    if (lastAnswer.type === 'level1' || lastAnswer.type === 'level2') {
                       scores[lastAnswer.dimension] -= lastAnswer.value;
                    } else if (lastAnswer.type === 'level3') {
                        narrativeChoice = '';
                    }
                }
                showQuestion();
            }
        }

        function showLoadingAndResults() {
            testContainerEl.classList.add('fade-out');
            setTimeout(() => {
                testContainerEl.style.display = 'none';
                loadingContainerEl.style.display = 'flex';
                
                let progress = 0;
                const interval = setInterval(() => {
                    progress += 1;
                    loadingBarInnerEl.style.width = `${progress}%`;
                    if (progress >= 100) {
                        clearInterval(interval);
                        setTimeout(() => {
                            loadingContainerEl.style.display = 'none';
                            showResults();
                        }, 500);
                    }
                }, 45);
            }, 500);
        }

        function showResults() {
            resultsContainerEl.style.display = 'block';
            resultsContainerEl.classList.add('fade-in');

            let primaryProfile = 'H';
            let highestScore = -1;

            let level1Scores = { H: 0, E: 0, X: 0, A: 0, C: 0, O: 0 };
            let level2Counts = { H: 0, E: 0, X: 0, A: 0, C: 0, O: 0 };

            userAnswers.forEach(ans => {
                if(ans.type === 'level1'){
                    level1Scores[ans.dimension] += ans.value;
                } else if(ans.type === 'level2'){
                    level2Counts[ans.dimension]++;
                }
            });
            
            for (const dim in level1Scores) {
                if (maxScores[dim] > 0) {
                    const normalizedScore = (level1Scores[dim] / maxScores[dim]) * 100;
                    if (normalizedScore > highestScore) {
                        highestScore = normalizedScore;
                        primaryProfile = dim;
                    }
                }
            }
            
            const isPrimaryHigh = (level1Scores[primaryProfile] / maxScores[primaryProfile]) * 100 >= 50;
            const mainProfileData = profiles[primaryProfile];
            
            const profileColor = mainProfileData.color;
            profileTitleEl.className = 'text-2xl md:text-3xl font-bold text-center mb-2';
            profileTitleEl.classList.add(profileColor);

            profileTitleEl.textContent = mainProfileData.title;
            const facetsData = mainProfileData[isPrimaryHigh ? 'high' : 'low'].facets;
            profileSubtypesEl.innerHTML = `Key Sub-Types: ${facetsData.map(f => `<strong>${f}</strong>`).join(', ')}`;
            profileSummaryEl.textContent = mainProfileData[isPrimaryHigh ? 'high' : 'low'].summary;
            
            let level2PrimaryDim = Object.keys(level2Counts).reduce((a, b) => level2Counts[a] > level2Counts[b] ? a : b);
            level2SummaryEl.innerHTML = `<h4 class="font-bold text-lg mb-2">In Action:</h4><p>Your responses to situational questions suggest that when faced with challenges, you tend to prioritize actions related to <strong>${profiles[level2PrimaryDim].title.toLowerCase()}</strong>, reinforcing your core traits in your daily decisions.</p>`;
            level3SummaryEl.innerHTML = `<h4 class="font-bold text-lg mb-2">Your Life Story:</h4><p>${level3Narratives[narrativeChoice] || "You have a unique perspective on your life's journey."}</p>`;

            traitDetailsEl.innerHTML = '';
            const dimensionNames = {
                H: 'Honesty-Humility', E: 'Emotionality', X: 'Extraversion',
                A: 'Agreeableness', C: 'Conscientiousness', O: 'Openness to Experience'
            };

            for (const dim in level1Scores) {
                if (maxScores[dim] > 0) {
                    const normalizedScore = (level1Scores[dim] / maxScores[dim]) * 100;
                    const isHigh = normalizedScore >= 50;
                    const breakdownText = profiles[dim][isPrimaryHigh ? 'high' : 'low'].breakdown;
                    const breakdownColor = profiles[dim].bgColor;

                    const traitHtml = `
                        <div class="p-4 rounded-xl shadow-sm ${breakdownColor}">
                            <div class="flex justify-between items-end mb-1">
                                <h4 class="text-lg font-bold">${dimensionNames[dim]}</h4>
                                <span class="font-semibold text-gray-600">${isHigh ? 'High' : 'Low'}</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-4 mb-2">
                                <div class="score-bar-gradient h-4 rounded-full" style="width: ${normalizedScore}%"></div>
                            </div>
                            <p class="text-gray-600">${breakdownText}</p>
                        </div>
                    `;
                    traitDetailsEl.innerHTML += traitHtml;
                }
            }
        }

        async function handleDownload() {
            const content = document.getElementById('results-content');
            shareMessageEl.textContent = 'Generating image...';
            try {
                const canvas = await html2canvas(content, { 
                    backgroundColor: '#f3f4f6',
                    scale: 2 
                });
                const link = document.createElement('a');
                link.href = canvas.toDataURL('image/png');
                link.download = 'my-personality-results.png';
                link.click();
                shareMessageEl.textContent = 'Results image downloaded!';
            } catch(err) {
                console.error("Download failed", err);
                shareMessageEl.textContent = 'Could not download results.';
            } finally {
                setTimeout(() => { shareMessageEl.textContent = ''; }, 3000);
            }
        }

        async function handleShare() {
            const shareText = `I took the Great Mind Profile test and my profile is "${profileTitleEl.textContent}"! Check your personality test on www.test.com for free!`;
            const shareData = {
                title: 'My Personality Results',
                text: shareText,
                url: window.location.href
            };
            try {
                if (navigator.share) {
                    await navigator.share(shareData);
                } else {
                    const textArea = document.createElement("textarea");
                    textArea.value = shareText;
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    try {
                        document.execCommand('copy');
                        shareMessageEl.textContent = 'Link copied to clipboard!';
                    } catch (err) {
                        shareMessageEl.textContent = 'Could not copy link.';
                    }
                    document.body.removeChild(textArea);
                }
            } catch (err) {
                console.error("Share failed", err);
                shareMessageEl.textContent = 'Could not share results.';
            } finally {
                setTimeout(() => { shareMessageEl.textContent = ''; }, 3000);
            }
        }

        // --- Event Listeners ---
        startTestBtn.addEventListener('click', startTest);
        backBtn.addEventListener('click', handleBackClick);
        retakeTestBtn.addEventListener('click', startTest);
        downloadBtn.addEventListener('click', handleDownload);
        shareBtn.addEventListener('click', handleShare);
        langIconBtn.addEventListener('click', () => langPopup.classList.remove('hidden'));
        closePopupBtn.addEventListener('click', () => langPopup.classList.add('hidden'));

    </script>
</body>
</html>
